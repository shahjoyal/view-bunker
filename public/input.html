<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Blend Dashboard — Bunkers</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#F7F8FA; --card:#fff; --muted:#6b7280; --accent:#02008a;
      --sidebar-width:170px;
      --bunker-top-line-distance: 46px;
      --arrow-width: 3px;
      --bunker-arrow-height: 220px;
      --arrow-head-size: 12px;
    }

    html,body{ margin:0; padding:0; width:100%; overflow-x:hidden; height:100%; font-family:Inter, system-ui, Arial; background:var(--bg); color:#111; }

    .app {
      display:flex;
      min-height:100vh;
      box-sizing:border-box;
    }

    /* sidebar */
    .sidebar {
      width:var(--sidebar-width);
      background:#fff;
      border-right:1px solid rgba(0,0,0,0.04);
      padding:12px 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .sidebar .title { font-weight:800; color:var(--accent); padding:8px 10px; font-size:13px; }
    .sidebar .item {
      display:block;
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
      font-weight:700;
      color:#111;
      font-size:13px;
    }
    .sidebar .item:hover { background:rgba(2,0,138,0.05); }
    .sidebar .item.active { background:var(--accent); color:#fff; box-shadow:0 6px 18px rgba(2,0,138,0.12); }

    /* main content */
    .main {
      flex:1;
      padding:12px 18px;
      box-sizing:border-box;
      overflow-y:auto;
    }

    .topbar {
      height:64px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:8px;
    }
    .topbar h1{ margin:0; font-size:16px; color:var(--accent); font-weight:800; }

    .controls{ display:flex; gap:8px; align-items:center; }
    .controls input{ padding:8px 10px; border-radius:8px; border:1px solid #e6e6e6; width:110px; font-size:14px; background:#fff; cursor:pointer; }

    .layout-card{ background:var(--card); border-radius:12px; padding:12px; box-shadow:0 10px 30px rgba(2,8,23,0.06); position:relative; overflow:visible; }

    .layout-row{ display:flex; gap:12px; align-items:flex-start; }

    .diagram-column{ flex:1 1 auto; min-width:0; }
    .stats-column{ width:160px; flex-shrink:0; }

    /* small compact stats panel */
    .stats-panel{
      width:100%; background:#02008a; color:#fff; padding:8px 10px; border-radius:8px;
      box-shadow:0 10px 22px rgba(2,8,23,0.10);
      display:flex; flex-direction:column; gap:6px; z-index:20;
      position:sticky; top:84px;
      font-size:13px;
    }
    .stat-row{ display:flex; justify-content:space-between; font-weight:700; }
    .stat-label{ opacity:0.95; font-weight:600; font-size:12px; color:rgba(255,255,255,0.95); }
    .stat-value{ font-weight:800; font-size:13px; }

    .diagram-inner { position:relative; padding:8px; }

    .top-overlay { position: absolute; inset: 0 0 0 0; pointer-events: none; z-index: 90; }
    /* top line black (solid) */
    .top-line { position: absolute; top: var(--bunker-top-line-distance); left: 4%; right: 4%; height: 3px; background: #000; opacity:1; }

    .arrow { position: absolute; width: var(--arrow-width); background: #000; top: calc(var(--bunker-top-line-distance) + 4px); height: var(--bunker-arrow-height); transform-origin: top center; }
    .arrow::after { content: ''; position: absolute; left: calc(50% - 8px); top: 100%; width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent; border-top: var(--arrow-head-size) solid #000; }

    /* bunkers - use flex so they shrink to fit width, preventing horizontal scroll */
    .bunkers-grid{ display:flex; gap:18px; align-items:end; padding:18px; }
    .bunker{ position:relative; flex:1 1 0; height:520px; display:flex; flex-direction:column; align-items:center; justify-content:flex-end; min-width:0; }
    .bunker svg{ width:100%; height:100%; max-height:480px; display:block; }
    .bunker .label{ position:absolute; bottom:12px; left:50%; transform:translateX(-50%); background:rgba(255,255,255,0.98); padding:6px 10px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.06); font-weight:700; font-size:13px; white-space:nowrap; }

    /* single-bunker view reduced height to avoid page scrolling */
    .single-bunker-wrap { padding:20px; display:flex; justify-content:center; align-items:flex-start; }
    .single-bunker { width:100%; max-width:920px; height:66vh; max-height:720px; display:flex; flex-direction:column; align-items:center; justify-content:flex-end; position:relative; }
    .single-bunker svg{ width:60%; height:92%; max-height:640px; display:block; }
    .single-bunker .label{ position: absolute; bottom:20px; left:50%; transform:translateX(-50%); background:rgba(255,255,255,0.98); padding:8px 12px; border-radius:10px; font-weight:800; font-size:16px; }

    /* tooltip */
    .coal-tooltip {
      position: absolute;
      pointer-events: none;
      background: #fff;
      color: #111;
      border: 1px solid rgba(0,0,0,0.12);
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
      padding: 10px;
      border-radius: 8px;
      font-size: 13px;
      line-height:1.35;
      z-index: 2000;
      display: none;
      min-width: 160px;
    }

    @media (max-width:1100px){
      .layout-row{ flex-direction:column; }
      .stats-column{ width:100%; order:2; }
      .sidebar{ display:none; } /* hide left sidebar on very small screens to save space */
      .single-bunker svg{ width:80%; }
    }
  </style>
</head>
<body>
  <div class="app">

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="title">Views</div>
      <div class="item active" data-mode="overview" id="tab-overview">Overview</div>
      <div class="item" data-mode="bunker" data-index="0">Bunker 1</div>
      <div class="item" data-mode="bunker" data-index="1">Bunker 2</div>
      <div class="item" data-mode="bunker" data-index="2">Bunker 3</div>
      <div class="item" data-mode="bunker" data-index="3">Bunker 4</div>
      <div class="item" data-mode="bunker" data-index="4">Bunker 5</div>
      <div class="item" data-mode="bunker" data-index="5">Bunker 6</div>
    </aside>

    <!-- Main -->
    <main class="main">
      <div class="topbar">
        <h1>Blend Dashboard — Bunkers</h1>
        <div class="controls">
          <input id="refreshBtn" type="button" value="Refresh" />
        </div>
      </div>

      <div class="layout-card">
        <!-- main row -->
        <div class="layout-row">
          <div class="diagram-column">
            <div class="diagram-inner" id="diagramInner">
              <div class="top-overlay" aria-hidden="true" id="topOverlay">
                <div class="top-line" id="topLine"></div>
                <div class="arrow" style="left:8.3333%;"></div>
                <div class="arrow" style="left:25%;"></div>
                <div class="arrow" style="left:41.6667%;"></div>
                <div class="arrow" style="left:58.3333%;"></div>
                <div class="arrow" style="left:75%;"></div>
                <div class="arrow" style="left:91.6667%;"></div>
              </div>

              <!-- Overview grid -->
              <div id="overviewView">
                <div class="bunkers-grid" id="bunkersGrid">
                  <div class="bunker" data-bunker="0"><svg viewBox="0 0 100 150" preserveAspectRatio="xMidYMid meet"></svg><div class="label">Bunker 1</div></div>
                  <div class="bunker" data-bunker="1"><svg viewBox="0 0 100 150" preserveAspectRatio="xMidYMid meet"></svg><div class="label">Bunker 2</div></div>
                  <div class="bunker" data-bunker="2"><svg viewBox="0 0 100 150" preserveAspectRatio="xMidYMid meet"></svg><div class="label">Bunker 3</div></div>
                  <div class="bunker" data-bunker="3"><svg viewBox="0 0 100 150" preserveAspectRatio="xMidYMid meet"></svg><div class="label">Bunker 4</div></div>
                  <div class="bunker" data-bunker="4"><svg viewBox="0 0 100 150" preserveAspectRatio="xMidYMid meet"></svg><div class="label">Bunker 5</div></div>
                  <div class="bunker" data-bunker="5"><svg viewBox="0 0 100 150" preserveAspectRatio="xMidYMid meet"></svg><div class="label">Bunker 6</div></div>
                </div>
              </div>

              <!-- Single bunker view (hidden initially) -->
              <div id="singleView" style="display:none;">
                <div class="single-bunker-wrap">
                  <div class="single-bunker" id="singleBunker">
                    <svg viewBox="0 0 100 150" preserveAspectRatio="xMidYMid meet" id="singleSvg"></svg>
                    <div class="label" id="singleLabel">Bunker 1</div>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <div class="stats-column">
            <div class="stats-panel" id="statsPanel" aria-hidden="false">
              <div style="font-size:13px;font-weight:800;">Summary</div>
              <div class="stat-row"><div class="stat-label">GEN</div><div class="stat-value" id="GEN">--</div></div>
              <div class="stat-row"><div class="stat-label">Flow (TPH)</div><div class="stat-value" id="TOTALFLOW">--</div></div>
              <div class="stat-row"><div class="stat-label">Avg GCV</div><div class="stat-value" id="AVGGCV">--</div></div>
              <div class="stat-row"><div class="stat-label">Avg AFT</div><div class="stat-value" id="AVGAFT">--</div></div>
              <div class="stat-row"><div class="stat-label">Heat Rate</div><div class="stat-value" id="HEATRATE">--</div></div>
              <div class="stat-row"><div class="stat-label">Cost (₹/MT)</div><div class="stat-value" id="COSTRATE">--</div></div>
              <div style="opacity:0.85;font-size:11px;margin-top:6px;">(data fetched from DB)</div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- floating tooltip element -->
  <div id="coalTooltip" class="coal-tooltip" aria-hidden="true"></div>

  <script src="/public/dashboard.js"></script>
</body>
</html>
